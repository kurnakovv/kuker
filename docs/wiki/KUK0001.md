## ðŸ’¡ Title
Kuk0001DuplicateArgumentsPassedToMethodAnalyzer

## ðŸ†” Rule ID
**KUK0001**

## ðŸ“ Description
This rule detects cases where the same argument is passed multiple times to a method as different arguments.

These issues often arise from copy-paste errors or the use of duplicate parameters with the same type.
In most APIs, such cases either have no effect or lead to incorrect behavior (e.g., copying a stream into itself).

## â” Why this is a problem
Imagine you're calling a method and need to pass several parameters. It's easy to accidentally pass the same parameter multiple times for various reasons - for example, you might have copied the wrong value, or the IDE suggested it incorrectly. This mistake might go unnoticed, as the program can still work. During code reviews or testing, you may overlook it, especially if the values happen to match and the method works as expected in certain cases.

## âš™ï¸ Configuration

You can configure the severity of the rule or exclude specific methods using .editorconfig.
```.editorconfig
[*.cs]
dotnet_diagnostic.KUK0001.severity = warning # Duplicate arguments passed to method | https://github.com/kurnakovv/kuker/wiki/KUK0001
dotnet_diagnostic.KUK0001.excluded_methods = Foo,Bar # Optional | Ignore selected methods
```

## ðŸ’» Example
```cs
async Task CopyStreams(CancellationToken token)
{
    var stream = new MemoryStream();
    var other = new MemoryStream();

    await stream.CopyToAsync(stream, token); // âŒ Violation: source and destination are the same.
    await stream.CopyToAsync(other, token);  // âœ… OK.
}

async Task CreateUser(UserCreateDto dto)
{
    if (_companyService.AnyAsync(dto.CompanyId))
    {
        throw new ObjectNotFoundException("Company not found");
    }

    // ...

    // âŒ Violation: Argument 'dto.CompanyId' is passed multiple times to the same method call.
    await _userService.CreateAsync(
        name: dto.Name,
        companyId: dto.CompanyId,
        roleId: dto.CompanyId, // âœ… Change dto.CompanyId -> dto.RoleId here.
        departmentId: dto.DepartmentId
        // ...
    );

    // ...
}
```

## ðŸ—’ï¸ Notes

- Argument analysis | This rule compares method arguments not only by variables, but also by complex expressions (e.g., property chains, nullable fields, arrays, binary operations, etc.).
- Constants | The rule doesn't apply to constants, as they are often used as default values and can be duplicated within a single method call.
- Method to Parameter | If you pass parameters through methods like `M1(a.GetSomething(), a.GetSomething())` this rule won't flag it, since such method calls may involve complex logic that justifies the duplication.
- False Positive | In some cases, passing the same value multiple times is correct. For example, when creating a square image, you might call `CreateImage(width: size, height: size)`, which is logically correct, as both sides must be equal. However, the rule will still flag this as a violation. Unfortunately, such situations can't be reliably detected by the analyzer, as only a human can determine if the duplication is intentional or accidental. To address this, there are several solutions.

Via code
```cs
int size = 100;

// âœ… Use #pragma | This approach may not be elegant, but it clearly indicates intentional duplication. It serves as a signal that you are deliberately passing the same parameter twice.
CreateImage(
    width: size,
#pragma warning disable KUK0001 // Duplicate arguments passed to method
    height: size
#pragma warning restore KUK0001 // Duplicate arguments passed to method
);

// âœ… Use variables | While creating additional variables adds some overhead, it results in cleaner and more readable code.
int width = size;
int height = size;

CreateImage(
    width: width,
    height: height
);
```

Via .editorconfig
```.editorconfig
# âœ… Ignore selected methods | This option disables the rule for specific methods, such as `CreateImage`. While useful, it applies the exclusion globally across all files, so it may not be ideal for all cases. Consider using this when the method frequently involves duplicate parameters.
dotnet_diagnostic.KUK0001.excluded_methods = CreateImage # Ignore selected methods

# âœ… Ignore specific files | This disables the rule in selected files, but be aware that it also affects ALL method calls within those files. As a result, other method calls might not be covered by the rule.
[{TestService.cs,TestDto.cs}]
dotnet_diagnostic.KUK0001.severity = none # Duplicate arguments passed to method | https://github.com/kurnakovv/kuker/wiki/KUK0001

# âœ… warning -> suggestion | Developers will "stumble" upon this suggestion every time they read the code, eventually leading them to ignore ALL suggestions, as they will recognize that most of them are false positives, and thus see no point in paying attention to them.
[*.cs]
dotnet_diagnostic.KUK0001.severity = suggestion # Duplicate arguments passed to method | https://github.com/kurnakovv/kuker/wiki/KUK0001
```

## ðŸ”— Links

- Issues: [#8](https://github.com/kurnakovv/kuker/issues/8) | [#22](https://github.com/kurnakovv/kuker/issues/22) | [#40](https://github.com/kurnakovv/kuker/issues/40)
- [Source code](https://github.com/kurnakovv/kuker/blob/dev/src/Kuker.Analyzers/Rules/Kuk0001DuplicateArgumentsPassedToMethodAnalyzer.cs)  
- More examples in [tests](https://github.com/kurnakovv/kuker/blob/dev/tests/Kuker.Analyzers.Tests/Rules/Kuk0001DuplicateArgumentsPassedToMethodAnalyzerTests.cs)  
- [Severity levels](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/configuration-options#severity-level)
